<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Backend | ParkSuJeong&#39;s devBlog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/vuepress_sujeong/images/title.png">
    <link rel="manifest" href="/vuepress_sujeong/manifest.json">
    <meta name="description" content="Hello World!">
    
    <link rel="preload" href="/vuepress_sujeong/assets/css/0.styles.5fa4dae3.css" as="style"><link rel="preload" href="/vuepress_sujeong/assets/js/app.862a767c.js" as="script"><link rel="preload" href="/vuepress_sujeong/assets/js/2.b40c6b36.js" as="script"><link rel="preload" href="/vuepress_sujeong/assets/js/14.3fbba026.js" as="script"><link rel="prefetch" href="/vuepress_sujeong/assets/js/10.b7519eaf.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/11.eb443594.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/12.35cd9ac3.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/13.ffb163e7.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/15.0d458c67.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/16.54cc0d03.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/17.a20f1b38.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/18.e281ebbe.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/19.edea28e7.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/20.a7f28825.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/21.8daedf2a.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/22.d6335356.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/23.94db0282.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/24.a1fb0e63.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/25.cf46b62a.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/26.6590b363.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/27.7b1fa9ac.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/3.624f62b8.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/4.af2ddeae.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/5.21534ce5.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/6.b8bdfc81.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/7.75366779.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/8.92dc45a2.js"><link rel="prefetch" href="/vuepress_sujeong/assets/js/9.c184184b.js">
    <link rel="stylesheet" href="/vuepress_sujeong/assets/css/0.styles.5fa4dae3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress_sujeong/" class="home-link router-link-active"><img src="/vuepress_sujeong/images/titleImage.jpg" alt="ParkSuJeong's devBlog" class="logo"> <span class="site-name can-hide">ParkSuJeong's devBlog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress_sujeong/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Study" class="dropdown-title"><span class="title">Study</span> <span class="arrow down"></span></button> <button type="button" aria-label="Study" class="mobile-dropdown-title"><span class="title">Study</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/devOps/" class="nav-link">
  DevOps
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/algorithm/" class="nav-link">
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/programming.html" class="nav-link">
  Programming
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/web/" class="nav-link">
  Web
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/backend/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Backend
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/frontend.html" class="nav-link">
  Frontend
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/dataAnalysis/" class="nav-link">
  DataAnalysis
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/cs/" class="nav-link">
  CS
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/machineLearning/" class="nav-link">
  MachineLearning
</a></li></ul></div></div><div class="nav-item"><a href="/vuepress_sujeong/project/" class="nav-link">
  Project
</a></div><div class="nav-item"><a href="/vuepress_sujeong/column/" class="nav-link">
  Column
</a></div><div class="nav-item"><a href="/vuepress_sujeong/contact/" class="nav-link">
  Contact
</a></div> <a href="https://github.com/ParkSuJeong74/vuepress_sujeong" target="_blank" rel="noopener noreferrer" class="repo-link">
    my-Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress_sujeong/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Study" class="dropdown-title"><span class="title">Study</span> <span class="arrow down"></span></button> <button type="button" aria-label="Study" class="mobile-dropdown-title"><span class="title">Study</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/devOps/" class="nav-link">
  DevOps
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/algorithm/" class="nav-link">
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/programming.html" class="nav-link">
  Programming
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/web/" class="nav-link">
  Web
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/backend/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Backend
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/frontend.html" class="nav-link">
  Frontend
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/dataAnalysis/" class="nav-link">
  DataAnalysis
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/cs/" class="nav-link">
  CS
</a></li><li class="dropdown-item"><!----> <a href="/vuepress_sujeong/study/machineLearning/" class="nav-link">
  MachineLearning
</a></li></ul></div></div><div class="nav-item"><a href="/vuepress_sujeong/project/" class="nav-link">
  Project
</a></div><div class="nav-item"><a href="/vuepress_sujeong/column/" class="nav-link">
  Column
</a></div><div class="nav-item"><a href="/vuepress_sujeong/contact/" class="nav-link">
  Contact
</a></div> <a href="https://github.com/ParkSuJeong74/vuepress_sujeong" target="_blank" rel="noopener noreferrer" class="repo-link">
    my-Repo
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/vuepress_sujeong/study/backend/" aria-current="page" class="active sidebar-link">Backend</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#웹-백엔드-스터디" class="sidebar-link">웹 백엔드 스터디</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#_5주차" class="sidebar-link">5주차</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#_6주차" class="sidebar-link">6주차</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#백엔드-스터디" class="sidebar-link">백엔드 스터디</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#node-js" class="sidebar-link">Node.js</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#노마더-코더-nest-js로-api-만들기" class="sidebar-link">노마더 코더 Nest.js로 API 만들기</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#개요" class="sidebar-link">개요</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#파일-구조" class="sidebar-link">파일 구조</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#pipe" class="sidebar-link">Pipe</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#dto-data-transfer-object-데이터-전송-객체" class="sidebar-link">DTO(Data transfer Object) : 데이터 전송 객체</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#module" class="sidebar-link">Module</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#express" class="sidebar-link">Express</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#테스트" class="sidebar-link">테스트</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#따라하며-배우는-nestjs" class="sidebar-link">따라하며 배우는 NestJS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#nest-js-란" class="sidebar-link">NEST.JS 란?</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#기본-구조" class="sidebar-link">기본 구조</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#애플리케이션-구조" class="sidebar-link">애플리케이션 구조</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#module-module" class="sidebar-link">Module(@Module)</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#controller-controller" class="sidebar-link">Controller(@Controller)</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#providers-service-injectable" class="sidebar-link">Providers&amp;Service(@Injectable)</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#서비스-제작" class="sidebar-link">서비스 제작</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#dto-data-transfer-object" class="sidebar-link">DTO(Data Transfer Object)</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#pipe-injectable" class="sidebar-link">Pipe(@Injectable)</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#postgresql" class="sidebar-link">PostgreSQL</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#typeorm" class="sidebar-link">typeORM</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#entity" class="sidebar-link">Entity</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#repository" class="sidebar-link">Repository</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#유저-데이터-유효성-체크" class="sidebar-link">유저 데이터 유효성 체크</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#암호화" class="sidebar-link">암호화</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#jwt" class="sidebar-link">JWT</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#log" class="sidebar-link">Log</a></li><li class="sidebar-sub-header"><a href="/vuepress_sujeong/study/backend/#configuration" class="sidebar-link">Configuration</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="backend"><a href="#backend" class="header-anchor">#</a> Backend</h1> <p><code>엘리스</code></p> <ol><li>웹 백엔드 스터디</li> <li>5주차</li> <li>6주차</li> <li>백엔드 스터디</li> <li><a href="https://www.youtube.com/watch?v=Xhj2TgWLDAo&amp;list=PL_cUvD4qzbkw-phjGK2qq0nQiG6gw1cKK&amp;ab_channel=AnsontheDeveloper&amp;loop=0" target="_blank" rel="noopener noreferrer">NestJS Tutorial<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>노마더 코더 Nest.js로 API 만들기</li> <li><a href="https://www.inflearn.com/course/%EB%94%B0%EB%9D%BC%ED%95%98%EB%8A%94-%EB%84%A4%EC%8A%A4%ED%8A%B8-%EC%A0%9C%EC%9D%B4%EC%97%90%EC%8A%A4" target="_blank" rel="noopener noreferrer">INFLEARN 따라하며 배우는 NestJS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <h2 id="웹-백엔드-스터디"><a href="#웹-백엔드-스터디" class="header-anchor">#</a> 웹 백엔드 스터디</h2> <h2 id="_5주차"><a href="#_5주차" class="header-anchor">#</a> 5주차</h2> <h2 id="_6주차"><a href="#_6주차" class="header-anchor">#</a> 6주차</h2> <h2 id="백엔드-스터디"><a href="#백엔드-스터디" class="header-anchor">#</a> 백엔드 스터디</h2> <h3 id="node-js"><a href="#node-js" class="header-anchor">#</a> Node.js</h3> <p>node.js 등장 배경</p> <p>복잡한 JS 실행을 위해 V8 → 어느 환경에서나 JS 실행 가능</p> <p><img src="https://user-images.githubusercontent.com/71163016/169000154-6b8707ae-6c5d-4883-9f8d-5ff3b3cbcd1e.png" alt="image"></p> <p><img src="https://user-images.githubusercontent.com/71163016/169000238-7dded44b-78be-4c9a-ad8e-9cef813a3197.png" alt="image"></p> <p><code>Browser의 JS</code>는 브라우저에서만 실행되고 웹 내부에 제한된 동작이 있으며 front-end 개발자의 언어이다.</p> <p><code>node.js</code>는 크로스 플랫폼 실행, 제한없는 동작, 다양한 어플리케이션 개발이 가능</p> <h2 id="노마더-코더-nest-js로-api-만들기"><a href="#노마더-코더-nest-js로-api-만들기" class="header-anchor">#</a> 노마더 코더 Nest.js로 API 만들기</h2> <p><a href="https://github.com/ParkSuJeong74/hi-nest" target="_blank" rel="noopener noreferrer">해당 깃허브 바로가기<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="개요"><a href="#개요" class="header-anchor">#</a> 개요</h3> <p>Node.js 위에 Express.js위에 Nest.js 프레임워크</p> <p>구조와 룰(아키텍처, 구조)이 정해져있다(node.js는 딱히)</p> <p>vscode, node, insomnia</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">npm</span> i -g @nestjs/cli
$ nest                     <span class="token comment"># 다른 커맨드들의 리스트 조회</span>
$ nest new project-name    <span class="token comment"># ./을 사용하면 현재 폴더를 nest로 만들어줌</span>
$ <span class="token function">npm</span> run start:dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="파일-구조"><a href="#파일-구조" class="header-anchor">#</a> 파일 구조</h3> <p>CLI 명령어</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ nest g co         <span class="token comment"># generate controller</span>
$ nest g s          <span class="token comment"># generate service</span>
$ nest g mo         <span class="token comment"># generate module</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>main.ts</li></ul> <p>기본함수</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> NestFactory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.module'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3000 포트</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>app.module.ts</li></ul> <p>데코레이터(@) : 클래스에 함수 기능을 추가할 수 있다. 클래스 위의 함수이고 클래스를 위해 움직인다. 반드시 함수나 클래스와 붙어있어야 하고 빈칸이 있으면 안된다.</p> <p>app.module은 기본이 되는 모듈이고, 인증을 담당하는 어플리케이션은 users.module.ts 등등 으로 사용할 수 있다.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>AppController<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// url를 가져오고 함수 실행(router)</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>AppService<span class="token punctuation">]</span><span class="token punctuation">,</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>app.controller.ts</li></ul> <p>url를 매핑, 리퀘스트 받기, query 넘김, body 등을 넘김</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>  <span class="token comment">// Post</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppController</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> appService<span class="token operator">:</span> AppService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Movie<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moviesServices<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">)</span>  <span class="token comment">// id보다 위에 있어야함</span>
    <span class="token function">search</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Query</span></span><span class="token punctuation">(</span><span class="token string">'year'</span><span class="token punctuation">)</span> searchingYear<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment">// search?year=2000</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">searching </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>searchingYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
    <span class="token function">getOne</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> movieId<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Movie<span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moviesServices<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>movieId<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">create</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> movieData<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moviesServices<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>movieData<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Delete</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> movieId<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moviesServices<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span>movieId<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Patch</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
    <span class="token function">patch</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> movieId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> updateData<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moviesServices<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>movieId<span class="token punctuation">,</span> updateData<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>Post를 쓰기 위해서는 Post를 import해주고 Post를 사용하면 된다. 가령 Post로 바꾼다음 /hello 주소로 접속한다면 해당 오류를 볼 수 있다.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;statusCode&quot;</span><span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Cannot GET /hello&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Not Found&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Put은 모든 리소스를 업데이트한다. Patch는 리소스의 일부분만 업데이트 해준다.</p> <ul><li>app.service.ts</li></ul> <p>controller와 비즈니스 로직을 구분하고자함. 실제로 함수를 가지는 부분이 서비스!</p> <p>로직을 관리하는 역할</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> movies<span class="token operator">:</span> Movie<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Movie<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movies
    <span class="token punctuation">}</span>

    <span class="token function">getOne</span><span class="token punctuation">(</span>id<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Movie<span class="token punctuation">{</span>
        <span class="token keyword">const</span> movie<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>movie <span class="token operator">=&gt;</span> movie<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token operator">+</span>id<span class="token punctuation">)</span> <span class="token comment">// +id == parseInt(id)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>movie<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NotFoundException</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Not Found Movie with ID : </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 예외처리, httpExceptino에서 확장된 nest 기능</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> movie
    <span class="token punctuation">}</span>

    <span class="token function">deleteOne</span><span class="token punctuation">(</span>id<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>movies<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>movie <span class="token operator">=&gt;</span> movie<span class="token punctuation">.</span>id <span class="token operator">!==</span> <span class="token operator">+</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">create</span><span class="token punctuation">(</span>movieData<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>movies<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token operator">...</span>movieData
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">update</span><span class="token punctuation">(</span>id<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span> updateData<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> movie <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>movie<span class="token punctuation">,</span> <span class="token operator">...</span>updateData<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 가짜 DB를 쓰기 때문에 사용하는 로직</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><ul><li>app.controller.spec.ts</li></ul> <p>테스트 파일</p> <p>*Single-responsibility principle : module, class, function이 하나의 기능은 반드시 책임져야한다.</p> <p>NotFoundException() : 예외처리</p> <h3 id="pipe"><a href="#pipe" class="header-anchor">#</a> Pipe</h3> <p>코드가 지나가는 구간, 유효성 검사를 위한 파이프를 생성할 수 있다.</p> <p>express에서는 미들웨어에 속함</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// main.ts</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  app<span class="token punctuation">.</span><span class="token function">useGlobalPipes</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">ValidationPipe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      whitelist<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 어떤 decorator도 없는 property의 object는 거름</span>
      forbidNonWhitelisted<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 이상한걸 보내면 request를 막음</span>
      transform<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 원하는 타입으로 변환(id의 디폴트는 string이지만 이제 controller부터 number로 가져올 수 있음)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="dto-data-transfer-object-데이터-전송-객체"><a href="#dto-data-transfer-object-데이터-전송-객체" class="header-anchor">#</a> DTO(Data transfer Object) : 데이터 전송 객체</h3> <p>전달해야하는 데이터, 전달 받아야하는 데이터 명시</p> <p>코드를 더 간결하게 만들 수 있도록 하는 역할, 쿼리의 유효성 검사 역할</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CreateMovieDTO</span><span class="token punctuation">{</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsString</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 유효성 검사</span>
    <span class="token keyword">readonly</span> title<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsNumber</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">readonly</span> year<span class="token operator">:</span> <span class="token builtin">number</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsString</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>each<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// each : 하나씩 검사</span>
    <span class="token keyword">readonly</span> genres<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>update의 경우 필수가 아니어도 작동하도록 설정</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> IsNumber<span class="token punctuation">,</span> IsString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;class-validator&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UpdateMovieDTO</span><span class="token punctuation">{</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsString</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">readonly</span> title<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 필수는 아님</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsNumber</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">readonly</span> year<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsOptional</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsString</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>each<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// each : 하나씩 검사</span>
    <span class="token keyword">readonly</span> genres<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>nest.js에서는 다르게도 가능하다.</p> <p>Partial types(부분 타입)을 사용하려면 @nestjs/mapped-types를 설치해야한다(swagger도 가능함)</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> PartialType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@nestjs/mapped-types&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CreateMovieDTO <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./create-movie.dto&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UpdateMovieDTO</span> <span class="token keyword">extends</span> <span class="token class-name">PartialType</span><span class="token punctuation">(</span>CreateMovieDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="module"><a href="#module" class="header-anchor">#</a> Module</h3> <p>dependency injection : class만 type으로 import
-&gt; provider를 import하고 controller에 inject(주입)
@Injectable</p> <h3 id="express"><a href="#express" class="header-anchor">#</a> Express</h3> <p>Nest는 express 위에서 작동하기 때문에 req, res를 사용할 수 있다.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Req</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> req<span class="token punctuation">,</span> <span class="token decorator"><span class="token at operator">@</span><span class="token function">Res</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> res<span class="token punctuation">)</span><span class="token operator">:</span> Movie<span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>하지만 좋은 방식은 아니다. fastify로 전환할 수 있기 때문이다.(2배 정도 빠르다.) =&gt; Nest.js 방식만 사용하는게 좋다.</p> <h3 id="테스트"><a href="#테스트" class="header-anchor">#</a> 테스트</h3> <p>Jest : Js를 쉽게 테스팅하는 npm 패키지</p> <p>movies.controller.spec.ts 파일로 movies.controller.ts 파일을 테스트할 수 있다.</p> <p>npm run test:cov : 얼마나 테스팅 되었는지를 알려줌</p> <p>npm run test:watch : 모든 테스팅 파일을 찾아서 무슨일이 일어나는지 관찰 -&gt; a를 누르면 전체 테스트</p> <p>테스팅 종류</p> <ul><li><p>유닛 테스팅(서비스에서 분리된 유닛을 테스트, function 하나를 테스트)</p></li> <li><p>end-to-end(e2e) 테스팅(모든 시스템 테스트, 특정 페이지가 나와야하는 경우 -&gt; 사용자 관점에서 특정 링크를 클릭시 액센 테스트)</p></li></ul> <p><strong>spec 파일</strong></p> <p>유닛 테스트를 위한 파일</p> <p>describe : 테스트 묘사</p> <p>beforeEach : 테스트를 하기 전에 실행하는 것</p> <p>afterAll, beforeAll, afterEach 같은 Hook</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should be defined'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// individual test개별 테스트 줄임말</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should be 4&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 2+2가 4와 같기를 기대함</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// √ should be 4 (4 ms) 결과 찍힘</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>test 폴더</strong></p> <p>e2e 테스트</p> <p>입력 받았을 때 출력을 주는지 전체 테스트</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'/ (GET)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">getHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="따라하며-배우는-nestjs"><a href="#따라하며-배우는-nestjs" class="header-anchor">#</a> 따라하며 배우는 NestJS</h2> <p><a href="https://github.com/ParkSuJeong74/nestjs_postgresql" target="_blank" rel="noopener noreferrer">해당 깃허브 바로가기<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="nest-js-란"><a href="#nest-js-란" class="header-anchor">#</a> NEST.JS 란?</h3> <p>효율적이고 확장 가능한 NODE.JS 서버 측 애플리케이션을 구축하기위한 프레임워크.</p> <p>express HTTP 서버 프레임워크 + Fastify</p> <p>[Nest.js 철학]</p> <p>고도의 테스트와 확장 가능성, 느슨한 결합, 유지 관리가 쉬운 애플리케이션을 만들 수 있도록 즉시 사용가능한 애플리케이션 아키텍처를 제공. Angular에서 영감을 받음</p> <h3 id="기본-구조"><a href="#기본-구조" class="header-anchor">#</a> 기본 구조</h3> <ul><li><p>.eslintrc.js : 코드 규칙 라이브러리. ts를 사용하는 가이드라인 제시, 문법에 오류가 나면 알려줌</p></li> <li><p>prettierrc : 코드 형식. 작은따옴표나 큰따옴표, indent값을 2로 할지 4로 할지 등등. 에러를 찾는 것이 아닌 코드 포맷터 역할</p></li> <li><p>nest-cli.json : nest에서의 특정한 설정(src 안이 root이다 등등)</p></li> <li><p>package.json : 라이브러리, 설정</p></li> <li><p>src 폴더 : 대부분의 비즈니스 로직이 들어감</p></li></ul> <h3 id="애플리케이션-구조"><a href="#애플리케이션-구조" class="header-anchor">#</a> 애플리케이션 구조</h3> <p>BoardModule : 게시글에 관련된 모듈(BoardController, BoardEntity, BoardService, BoardRepository, ValidationPipe)</p> <p>AuthModule : 게시글을 만드는 사람에 대한 인증 모듈(AuthController, UserEntity, AuthService, UserRepositroy, JWT, Passport)</p> <h3 id="module-module"><a href="#module-module" class="header-anchor">#</a> Module(@Module)</h3> <p>@Module 데코레이터로 주석이 달린 클래스. 메타데이터 제공</p> <p>하나 이상의 모듈(root 모듈)이 있어야함</p> <p>밀접하게 관련된 기능 집합. 하나의 모듈 폴더에 같은 기능이 들어감</p> <p>기본적으로 싱글톤으로 여러 모듈간에 쉽게 공급자의 동일한 인스턴스를 공유할 수 있음</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ nest g mo boards
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="controller-controller"><a href="#controller-controller" class="header-anchor">#</a> Controller(@Controller)</h3> <p>들어오는 요청을 처리하고 클라이언트에 응답 반환</p> <p>Handler : @Get, @Post, @Delete 와 같은 컨트롤러 클래스 내의 메서드</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ nest g co boards    <span class="token comment"># controller와 테스트 파일, module에 controller 추가</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="providers-service-injectable"><a href="#providers-service-injectable" class="header-anchor">#</a> Providers&amp;Service(@Injectable)</h3> <p>Providers : 대부분 기본 Nest 클래스는 서비스, 리포지토리, 팩토리, 헬퍼 등 프로바이더로 취급</p> <p>종속성에 주입할 수 있다는 것</p> <p>객체는 서로 다양한 관계를 만들 수 있고 객체의 인스턴스를 연결하는 기능은 대부분 Nest 런타임 시스템에 위임</p> <p>즉 Controller에서 Service를 종속적으로 사용한다는 뜻이다.</p> <p>Service : @Injectable 데코레이터로 감싸져서 모듈에 제공됨 -&gt; 전체에서 사용될 수 있음</p> <p>서비스는 컨트롤러에서 데이터의 유효성을 체크하거나 DB에 아이템을 생성하는 등의 작업을 하는 부분 처리</p> <p>Dependency Injection : Service에서 정의한 메소드를 controller에서 쓰는 것</p> <p>controller의 constructor에서 Private type의 파라미터로 프로퍼티를 넣어서 this.(type).메소드 형식으로 사용</p> <p>Provider 등록 : module에서 추가</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ nest g s boards    <span class="token comment"># service와 테스트 파일, module에 service 추가</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>접근제한자 private를 사용하여 controller에서 service를 등록</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'boards'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">BoardsController</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> boardService<span class="token operator">:</span> BoardsService<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="서비스-제작"><a href="#서비스-제작" class="header-anchor">#</a> 서비스 제작</h3> <p>클라이언트에서 요청을 보내면 먼저 컨트롤러에 라우팅해서 해당 핸들러로 이동 -&gt; 서비스로 들어가 로직을 처리해주고 컨트롤러에서 클라이언트로 결과값 보내줌</p> <p>게시물을 만든다면, 게시물의 모델을 만들어서 board.model.ts</p> <p>classes : 변수의 타입 체크와 인스턴스 생성</p> <p>interface : 변수의 타입만 체크</p> <p>공개 게시물과 비공개 게시물을 나누는 status를 주기 위해 도메인을 설정</p> <p>두 상태만 나올 수 있도록 enumeration 사용</p> <p>타입 설정</p> <p>ID는 DB에서 알아서 유니크한 값을 줌 -&gt; 지금은 uuid 사용</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">npm</span> <span class="token function">install</span> uuid --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> v1 <span class="token keyword">as</span> uuid <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'uuid'</span>
<span class="token keyword">const</span> board<span class="token operator">:</span> Board <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    title<span class="token punctuation">,</span>
    description<span class="token punctuation">,</span>
    status<span class="token operator">:</span> BoardStatus<span class="token punctuation">.</span><span class="token constant">PUBLIC</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>express에서는 bodyParser 모듈을 이용해서 클라이언트에서 값을 받았지만, Nest에서는 @Body('title') title 로 가져옴</p> <p>prettier, eslint는 <strong>npx eslint . --fix</strong>로 실행</p> <h3 id="dto-data-transfer-object"><a href="#dto-data-transfer-object" class="header-anchor">#</a> DTO(Data Transfer Object)</h3> <p>계층간 데이터 교환을 위한 객체로 DB에서 데이터를 얻어 service나 controller 등으로 보낼 때 사용하는 객체</p> <p>데이터가 네트워크를 통해 전송되는 방법을 정의</p> <p>interface나 class를 이용해서 정의하는데 class를 추천 -&gt; 런타임에서 작동하기 때문에 pipe 같은 기능을 이용할 때 더 유용합니다.</p> <p>쓰는 이유 : 데이터 유효성 체크에 효율적, 안정적인 코드, ts 타입으로 사용, 코드 수정에 용이</p> <p>property를 여러곳에서 사용중인데 수정하려고 하면 많이 고쳐줘야하기 때문에, 유지보수를 위해 DTO 사용</p> <p>특정한 게시글을 가져올때는 id type을 전달(@Params를 가져올때 전체를 가져오면 @Param() params: string[]으로 가져올 수 있음)</p> <h3 id="pipe-injectable"><a href="#pipe-injectable" class="header-anchor">#</a> Pipe(@Injectable)</h3> <p>data transformation, data validation을 위해서 사용됨</p> <p>컨트롤러 경로 처리기에 의해 처리되는 인수에 의해 작동</p> <p>메소드가 호출되기 직전에 파이프를 삽입하고 파이프는 메소드로 향하는 인수를 수신하고 이에 의해 작동함</p> <ul><li><p>data transformation : 입력 데이터를 원하는 형식으로 변환(문자열 -&gt; 정수)</p></li> <li><p>data validation : 입력데이터가 유효하지 않은 경우 에러를 발생</p></li></ul> <p>-&gt; Binding Pipes : 파이프 사용법</p> <ul><li><p>Handler-level pipes : <strong>@UsePipes()</strong> 데코레이터 사용. 이 파이프는 모든 파라미터에 적용됨. router하나에만 적용됨</p></li> <li><p>parameter-level pipes : parameter 레벨의 파이프. 특정한 파라미터에만 적용됨 (@Body('title', ParameterPipe) title)</p></li> <li><p>global-level pipes : 애플리케이션 레벨의 파이프. 클라이언트에서 들어오는 모든 요청에 적용됨. main.ts에 위치(app.useGlobalPipes(GlobalPipes))</p></li></ul> <p>Built-in Pipes : Nest에서 만들어둔 6가지의 파이프</p> <ul><li><p>ValidationPipe : 유효성 체크</p></li> <li><p>ParseIntPipe : 숫자가 와야하는 핸들러일때 사용</p></li> <li><p>ParseBoolPipe</p></li> <li><p>ParseArrayPipe</p></li> <li><p>ParseUUIDPipe</p></li> <li><p>DefaultValuePipe</p></li></ul> <p>Pipe 생성 - 유효성 체크</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> class-validator class-transformer --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><a href="https://github.com/typestack/class-validator#manual-validation" target="_blank" rel="noopener noreferrer">유효성 검사할 때 참고<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>커스텀 파이프 : PipeTransform 인터페이스, transform 메소드</p> <p>transform() 메소드는 처리가 된 인자의 값value, 인자에 대한 메타데이터를 포함한 객체를 파라미터로 가짐 -&gt; return이 된 값은 route 핸들러로 전해지고, 예외Exception 발생시 클라이언트로 전달</p> <p>metadata: ArgumentMetadata로 설정하면 matatype, type(body 등), data를 저장함</p> <p>상태가 public과 private만 가능하게 유효성 검사할 수 있음</p> <h3 id="postgresql"><a href="#postgresql" class="header-anchor">#</a> PostgreSQL</h3> <p><a href="https://www.postgresql.org/download/windows/" target="_blank" rel="noopener noreferrer">postgresql<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> + <a href="https://www.pgadmin.org/download/" target="_blank" rel="noopener noreferrer">pgAdmin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 설치</p> <p>pdAdmin : 웹 브라우저 기반 데이터베이스 관리 GUI이다.</p> <p>server에 DB 생성!</p> <h3 id="typeorm"><a href="#typeorm" class="header-anchor">#</a> typeORM</h3> <p>객체 관계형 매퍼 라이브러리(mySQL, Postgres, MariaDB, SQLite, MS SQL Server, Oracle, SAP Hana, WebSQL)</p> <p>ORM : 객체와 관계형 데이터베이스 데이터를 자동으로 연결하는 작업</p> <p>모델을 기반으로 테이블 체계를 자동 생성. 데이터베이스에서 개체를 쉽게 삽입하고 업데이트, 삭제할 수 있으며, 테이블 간의 매핑도 만듬. CLI 제공</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">npm</span> <span class="token function">install</span> pg typeorm @nestjs/typeorm --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>remove() : 무조건 존재하는 아이템을 지움(에러 발생)</p></li> <li><p>delete() : 아이템이 존재하면 지우고 아니면 아무런 영향이 없음</p></li></ul> <p>remove를 사용하면 아이템의 유무를 확인하고 지우기, 즉 두번 데이터 베이스에 접근해야함!</p> <h3 id="entity"><a href="#entity" class="header-anchor">#</a> Entity</h3> <p>@Entity() : 클래스가 엔티티</p> <p>@PrimaryGeneratedColumn() : 기본키</p> <p>@Column() : 열</p> <h3 id="repository"><a href="#repository" class="header-anchor">#</a> Repository</h3> <p>entity 개체와 함께 작동하며 엔티티 찾기, 삽입, 삭제 처리</p> <p>repository pattern : 데이터베이스에 관련된 일을 서비스가 하지 않고 repository에서 함(insert, find, delete)</p> <p>@EntityRepository() : custom 저장소로 선언하는데 사용됨(버전 업그레이드 되면서 사용 안됨)</p> <p><a href="https://docs.nestjs.com/recipes/sql-typeorm" target="_blank" rel="noopener noreferrer">공식문서 참고<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>async - await : 데이터베이스 작업이 끝난 후 결과값 받음</p> <h3 id="유저-데이터-유효성-체크"><a href="#유저-데이터-유효성-체크" class="header-anchor">#</a> 유저 데이터 유효성 체크</h3> <p>Class-validator</p> <p>try catch문을 사용해서 원하는 status 코드와 문구를 줄 수 있다.</p> <h3 id="암호화"><a href="#암호화" class="header-anchor">#</a> 암호화</h3> <p>bcryptjs</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">npm</span> <span class="token function">install</span> bcryptjs --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>import * as bcrypt from 'bcryptjs'로 사용한다.</p> <p>비밀번호를 데이터베이스에 저장하는 두가지 방법</p> <p>Encryption Key와 함께 양방향으로 암호화(알고리즘 + 암호화 키) : 어떤 암호를 이용해서 비밀번호를 암호화하고 그 암호를 이용해서 복호화(키가 노출되면 위험함)</p> <p>SHA256 등으로 해시Hash해서 저장(단방향) : 복호화 불가능</p> <p>-&gt; 레인보우 테이블을 만들어서 암호화된 비밀번호를 비교해서 비밀번호 알아내야함(비슷한 암호를 사용해서 보안 취약) -&gt; salt + 비밀번호를 암호화해서 저장함</p> <h3 id="jwt"><a href="#jwt" class="header-anchor">#</a> JWT</h3> <p>Json Web Token : 당사자 간에 정보를 json 개체로 안전하게 전송하기 위한 컴팩트하고 독립적인 방식을 정의하는 개방형 표준RFC7519. 이 정보는 디지털 서명이 되어 있어 확인하고 신뢰할 수 있음</p> <p>권한을 체크하기 위해 사용함</p> <ul><li><p>Header : 토큰에 대한 메타 데이터 포함(타입, 해싱 알고리즘, SHA256, RSA...)</p></li> <li><p>Payload : 유저 정보(issuer), 만료 기간(expiration time), 주제(subject)</p></li> <li><p>Verify Signature : 토큰이 보낸 사람에 의해 서명되었으며 어떤 식으로 변경되지 않았는지 확인하는 서명.</p></li></ul> <p><a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">jwt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>유저가 로그인하면 토큰을 생성함(hashing 알고리즘으로 jwt) -&gt; 토큰 보관</p> <p>서버에서 요청에서 같이 온 header와 payload를 가져오고 서버안에 가지고 있는 secret를 이용해서 signature 부분을 다시 생성. 일치하면 통과</p> <h3 id="log"><a href="#log" class="header-anchor">#</a> Log</h3> <p>로그 종류</p> <p>Log : 중요한 정보의 범용 로깅</p> <p>Warning : 치명적이거나 파괴적이진 않는 처리되지 않은 문제</p> <p>Error : 치명적이거나 파괴적인 처리되지 않은 문제</p> <p>Debug : 오류 발생시 로직을 디버그하는데 도움이 되는 유용한 정보</p> <p>Verbose : 응용 프로그램의 동작에 대한 통찰력을 제공하는 정보</p> <p>로그 레벨</p> <p>Development : Log, Error, Warning, Debug, Verbose</p> <p>Staging : Log, Error, Warning</p> <p>Production : Log, Error</p> <p>Nest에는 built-in된 Logger 클래스가 있음!</p> <h3 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h3> <p>runtime 도중에 바뀌는 것이 아니라 애플리케이션이 시작될 때 로드되어 정의해줘야함</p> <p>Codebase : 노출이 되어도 상관없는 정보들</p> <p>Environment Variables : 비밀번호나 API Key 같은 노출되면 안되는 정보들</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">npm</span> <span class="token function">install</span> -g win-node-env
$ <span class="token function">npm</span> <span class="token function">install</span> config --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>root 디렉토리에 config 폴더 안에 json이나 yaml 형식의 파일 생성</p> <ul><li><p>default.yaml :  기본 설정(개발 환경 설정이나 운영 환경 설정에도 적용됨)</p></li> <li><p>development.yaml : default에서 설정 + 개발 환경에서 필요한 정보</p></li> <li><p>production.yaml : default에서 설정 + 운영 환경에서 필요한 정보</p></li></ul> <p>jwt expiresIn : 3600으로 하면 한시간</p> <p>db: synchronize : true로 하면 시작할때마다 entity 생성</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ParkSuJeong74/vuepress_sujeong/edit/master/study/backend/README.md" target="_blank" rel="noopener noreferrer">Improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/vuepress_sujeong/assets/js/app.862a767c.js" defer></script><script src="/vuepress_sujeong/assets/js/2.b40c6b36.js" defer></script><script src="/vuepress_sujeong/assets/js/14.3fbba026.js" defer></script>
  </body>
</html>
